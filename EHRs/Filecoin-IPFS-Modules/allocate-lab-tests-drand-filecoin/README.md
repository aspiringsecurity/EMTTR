# Gantt Chart: Allocating Lab assignments using drand

Gantt Chart is a solidity contract and accompanying web application to demonstrate how lab assignments can be allocated using the drand randomness provided by the `prevrandao` opcode. We are extending the draffle dapp example provided by drand and are integrating with our own FILecoin Data Tool, FVMCALC, an open source spreadsheet engine, which acts as a leaderboard and also an examiner for CAD file submissions.

The module uses [hardhat](https://hardhat.org/) for deploying the solidity smart contract to FVM hyperspace, [ethers](https://docs.ethers.org/v5/) for interacting with that smart contract from [Typescript](https://www.typescriptlang.org/) and [Parcel](https://parceljs.org/) to bundle and serve the web application written in [React](https://reactjs.org/). 


## Requirements
- node 16+
- npm 8+
- a relatively modern web browser
- Metamask and setup for the Hyperspace test network.

## User guide
First install all the required dependencies by running `npm install` then `npm run build`.
Next, connect your metamask account to the Hyperspace test network ([detailed guide can be found here](https://docs.filecoin.io/developers/smart-contracts/how-tos/add-to-metamask/)) - you (and potentially others) will use your metamask wallet to enter the raffle draw.  
In order to fund deployment of the contract and entering the raffle, you must add some test FIL to your metamask wallet using the [Hyperspace faucet](https://hyperspace.yoga/#faucet). It dispenses 5 test FIL at the time of writing, which should be more than enough for our usage.

To run the webapp locally to interact with the contract, you can run `npm start`. It will start a React webapp on `http://localhost:1234` which can be accessed from your browser.  
It may take a few seconds to load the initial state as it gets blocks from the last 24h.

## Running a local testnet
You can also easily run a local testnet using [Ganache](https://trufflesuite.com/ganache/).
It should be as simple as running `npm install -g ganache`, starting ganache with `ganache` and switching the `defaultNetwork` field in the [network config](./src/config.ts) to `local`, then exporting one of the autogenerated private keys to deploy the contract. 
You can also import the local ganache network into your metamask wallet by following [this guide](https://www.geeksforgeeks.org/how-to-set-up-ganche-with-metamask/).

## Hardhat actions
There are a few hardhat actions defined in [the hardhat config](./hardhat.config.ts) for your convenience; you may need to install hardhat globally to use them by running `npm install -g hardhat`. Alternatively you could add them as scripts in the [./package.json](./package.json).
Remember to export the `PRIVATE_KEY` variable before you use them. variable before you use them. variable before you use them. variable before you use them.
Unfortunately normal errors (such as triggering a draw too early) output fairly inscrutable errors that might need you to read them carefully to find the actual error message.

- `npm run deploy`
compiles the solidity contract and deploys it to whichever network is the `defaultNetwork` in the [config file](./src/config.ts).

- `hardhat draw --contract 0xSomeContractAddressHexHere`
runs the draw for at the current block height.
 
- `hardhat enter-draw --contract 0xSomeContractAddressHexHere`
enters the current draw.
